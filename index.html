<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Short.io Human Clicks Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; background:#f4f6f8; display:flex; justify-content:center; padding:30px; }
.container { background:white; padding:25px; border-radius:10px; width:750px; box-shadow:0 3px 10px rgba(0,0,0,0.1); }
input, select, button { width:100%; padding:10px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
button { background:#007bff; color:white; cursor:pointer; }
button:hover { background:#0056b3; }
h2,h3 { text-align:center; }
.stats { font-size:22px; text-align:center; margin:10px 0; }
canvas { margin-top:20px; }
.flex { display:flex; justify-content:space-between; gap:10px; }
.flex input, .flex select { width:48%; }
</style>
</head>
<body>
<div class="container">
<h2>ðŸ”— Short.io Human Clicks Dashboard</h2>
<input id="linkId" placeholder="Enter Link ID" value="lnk_6sfV_JqPMeBLeyrvLSq0JBUEem">

<div class="flex">
<select id="period">
<option value="today">Today</option>
<option value="yesterday">Yesterday</option>
<option value="week">This Week</option>
<option value="month">This Month</option>
<option value="total" selected>Total</option>
</select>
<input type="date" id="startDate">
<input type="date" id="endDate">
</div>

<button onclick="getStats()">Get Stats</button>

<div class="stats" id="humanClicks">Human Clicks: --</div>

<h3>Top Countries (Human Clicks)</h3>
<canvas id="countryChart"></canvas>

<h3>Date-wise Human Click Trend</h3>
<canvas id="lineChart"></canvas>
</div>

<script>
let countryChart, lineChart;

async function getStats(){
  const linkId = document.getElementById('linkId').value;
  const periodSelect = document.getElementById('period').value;
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;

  if(!linkId){ alert("Enter Link ID"); return; }

  const params = new URLSearchParams({ linkId });

  if(startDate && endDate){
    params.set('startDate', startDate);
    params.set('endDate', endDate);
    params.set('period', 'custom');
  } else {
    params.set('period', periodSelect);
  }

  const res = await fetch(`/api/stats?${params.toString()}`);
  const data = await res.json();

  document.getElementById('humanClicks').innerText = `Human Clicks: ${data.humanClicks || 0}`;

  const countries = data.country || [];
  const countryLabels = countries.map(c=>c.countryName);
  const countryValues = countries.map(c=>c.score);

  if(countryChart) countryChart.destroy();
  const ctx1 = document.getElementById('countryChart').getContext('2d');
  countryChart = new Chart(ctx1,{
    type:'line',
    data:{ labels:countryLabels, datasets:[{ label:'Human Clicks by Country', data:countryValues, borderColor:'rgba(0,123,255,0.8)', backgroundColor:'rgba(0,123,255,0.3)', fill:true }] },
    options:{ responsive:true, scales:{ y:{ beginAtZero:true } } }
  });

  const clickStats = data.clickStatistics?.datasets?.[0]?.data || [];
  const lineLabels = clickStats.map(item => item.label || item.date || "");
  const lineValues = clickStats.map(item => item.value || 0);

  if(lineChart) lineChart.destroy();
  const ctx2 = document.getElementById('lineChart').getContext('2d');
  lineChart = new Chart(ctx2,{
    type:'line',
    data:{ labels:lineLabels, datasets:[{ label:'Human Clicks', data:lineValues, borderColor:'rgba(255,99,132,0.8)', backgroundColor:'rgba(255,99,132,0.3)', fill:true }] },
    options:{ responsive:true, scales:{ y:{ beginAtZero:true } } }
  });
}
</script>
</body>
</html>
